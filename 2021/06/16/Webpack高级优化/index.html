<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/dog-favicon.JPG">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/dog-favicon.JPG">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/dog-favicon.JPG">
  <link rel="mask-icon" href="/dog-favicon.JPG" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.1.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="Webpack高级优化提升开发体验sourcemap 打包完后的代码不便与阅读  因此需要sourcemap来生成源代码与构建后代码的一一映射  会生成xxx.map文件，包含源代码与构建后代码每一行，每一列的映射关系  如果构建代码出错，通过xxx.map文件可以定位到源代码出错位置   使用">
<meta property="og:type" content="article">
<meta property="og:title" content="Webpack高级优化">
<meta property="og:url" content="http://example.com/2021/06/16/Webpack%E9%AB%98%E7%BA%A7%E4%BC%98%E5%8C%96/index.html">
<meta property="og:site_name" content="SunleDog">
<meta property="og:description" content="Webpack高级优化提升开发体验sourcemap 打包完后的代码不便与阅读  因此需要sourcemap来生成源代码与构建后代码的一一映射  会生成xxx.map文件，包含源代码与构建后代码每一行，每一列的映射关系  如果构建代码出错，通过xxx.map文件可以定位到源代码出错位置   使用">
<meta property="og:locale">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/chiguayeshao/pic-bed/image-20220608114848178.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/chiguayeshao/pic-bed/image-20220608120638753.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/chiguayeshao/pic-bed/image-20220608120658005.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/chiguayeshao/pic-bed/image-20220608122751327.png">
<meta property="article:published_time" content="2021-06-16T14:25:40.000Z">
<meta property="article:modified_time" content="2022-06-23T05:56:12.228Z">
<meta property="article:author" content="Xiaotian Ye">
<meta property="article:tag" content="Webpack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/chiguayeshao/pic-bed/image-20220608114848178.png">


<link rel="canonical" href="http://example.com/2021/06/16/Webpack%E9%AB%98%E7%BA%A7%E4%BC%98%E5%8C%96/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>
<title>Webpack高级优化 | SunleDog</title>
  



  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="SunleDog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband">
    <a target="_blank" rel="noopener" href="https://github.com/chiguayeshao" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  </div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">SunleDog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">SunleDog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Webpack%E9%AB%98%E7%BA%A7%E4%BC%98%E5%8C%96"><span class="nav-number">1.</span> <span class="nav-text">Webpack高级优化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%90%E5%8D%87%E5%BC%80%E5%8F%91%E4%BD%93%E9%AA%8C"><span class="nav-number">1.1.</span> <span class="nav-text">提升开发体验</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#sourcemap"><span class="nav-number">1.1.1.</span> <span class="nav-text">sourcemap</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%90%E5%8D%87%E6%89%93%E5%8C%85%E6%9E%84%E5%BB%BA%E9%80%9F%E5%BA%A6"><span class="nav-number">1.2.</span> <span class="nav-text">提升打包构建速度</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HotModuleReplacement"><span class="nav-number">1.2.0.1.</span> <span class="nav-text">HotModuleReplacement</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#network-cache"><span class="nav-number">1.2.1.</span> <span class="nav-text">network cache</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pwa"><span class="nav-number">1.2.2.</span> <span class="nav-text">pwa</span></a></li></ol></li></ol></li></ol></div>
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Xiaotian Ye"
      src="/uploads/avatar.JPG">
  <p class="site-author-name" itemprop="name">Xiaotian Ye</p>
  <div class="site-description" itemprop="description">Developer</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
        
          <span class="site-state-item-count">39</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/chiguayeshao" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;chiguayeshao" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:xiaotian.yxt@outlook.com" title="E-Mail → mailto:xiaotian.yxt@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-binoculars fa-fw"></i>
      Friends
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://edi.wang/" title="https:&#x2F;&#x2F;edi.wang" rel="noopener" target="_blank">Edi Wang</a>
        </li>
    </ul>
  </div>

        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/06/16/Webpack%E9%AB%98%E7%BA%A7%E4%BC%98%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.JPG">
      <meta itemprop="name" content="Xiaotian Ye">
      <meta itemprop="description" content="Developer">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SunleDog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Webpack高级优化
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-06-16 22:25:40" itemprop="dateCreated datePublished" datetime="2021-06-16T22:25:40+08:00">2021-06-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Webpack/" itemprop="url" rel="index"><span itemprop="name">Webpack</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Webpack高级优化"><a href="#Webpack高级优化" class="headerlink" title="Webpack高级优化"></a>Webpack高级优化</h1><h2 id="提升开发体验"><a href="#提升开发体验" class="headerlink" title="提升开发体验"></a>提升开发体验</h2><h3 id="sourcemap"><a href="#sourcemap" class="headerlink" title="sourcemap"></a>sourcemap</h3><ol>
<li><p>打包完后的代码不便与阅读</p>
</li>
<li><p>因此需要sourcemap来生成源代码与构建后代码的一一映射</p>
</li>
<li><p>会生成xxx.map文件，包含源代码与构建后代码每一行，每一列的映射关系</p>
<ol>
<li>如果构建代码出错，通过xxx.map文件可以定位到源代码出错位置</li>
</ol>
</li>
<li><p>使用</p>
</li>
</ol>
<span id="more"></span>

<ol>
<li><p>开发模式</p>
<ol>
<li><p><code>cheap-module-source-map</code></p>
<ul>
<li><p>优点：打包编译快，只含行映射</p>
</li>
<li><p>缺点：没有列映射</p>
</li>
<li><pre><code class="javascript">module.exports = &#123;
  // 其他省略
  mode: &quot;development&quot;,
  devtool: &quot;cheap-module-source-map&quot;,
&#125;;
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">2</span>. 生产模式</span><br><span class="line"></span><br><span class="line">   <span class="number">1</span>. `source-map`</span><br><span class="line"></span><br><span class="line">      - 优点：包含行/列映射 （生产模式打包后的代码时是压缩为一行的，没有列映射很难定位出错位置）</span><br><span class="line"></span><br><span class="line">      - 缺点：打包编译速度更慢</span><br><span class="line"></span><br><span class="line">      - ```javascript</span><br><span class="line">        module.exports = &#123;</span><br><span class="line">          // 其他省略</span><br><span class="line"><span class="title">          mode:</span> <span class="string">&quot;production&quot;</span>,</span><br><span class="line"><span class="title">          devtool:</span> <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">        &#125;<span class="comment">;</span></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<h2 id="提升打包构建速度"><a href="#提升打包构建速度" class="headerlink" title="提升打包构建速度"></a>提升打包构建速度</h2><h4 id="HotModuleReplacement"><a href="#HotModuleReplacement" class="headerlink" title="HotModuleReplacement"></a>HotModuleReplacement</h4><ol>
<li><p>开发过程中，我们修改了一个模块的代码，webpack默认将所有模块重新编译打包，速度很慢</p>
<ul>
<li>因此我们只需要对修改的模块重新编译打包，其他模块不变就可以提升打包速度</li>
</ul>
</li>
<li><p>HotModuleReplacement（HMR/热模块替换）：在程序运行中，替换、添加或删除模块，而无需重新加载整个页面</p>
</li>
<li><p>配置</p>
<ol>
<li><pre><code class="javascript">module.exports = &#123;
  // 其他省略
  devServer: &#123;
    host: &quot;localhost&quot;, // 启动服务器域名
    port: &quot;3000&quot;, // 启动服务器端口号
    open: true, // 是否自动打开浏览器
    hot: true, // 开启HMR功能（只能用于开发环境，生产环境不需要了）
  &#125;,
&#125;;
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   <span class="number">2</span>. 可以在js中判断是否支持hmr，但是会非常麻烦</span><br><span class="line"></span><br><span class="line">      - ![image-<span class="number">20220607180103928</span>](https:<span class="regexp">//</span>cdn.jsdelivr.net<span class="regexp">/gh/</span>chiguayeshao<span class="regexp">/pic-bed/im</span>age-<span class="number">20220607180103928</span>.png)</span><br><span class="line"></span><br><span class="line">   <span class="number">3</span>. 实际开发过程中用loader来解决</span><br><span class="line"></span><br><span class="line">      - React-hot-loader</span><br><span class="line"></span><br><span class="line"><span class="comment">### OneOf</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. 打包过程中，每个文件会经过所有loader处理，虽然正则没有匹配上，但是都需要经过一遍，浪费时间</span><br><span class="line"><span class="number">2</span>. 使用oneof：只要有一个匹配上了就不进行多余操作</span><br><span class="line"><span class="number">3</span>. 配置webpack</span><br><span class="line">   - ![image-<span class="number">20220607182231155</span>](https:<span class="regexp">//</span>cdn.jsdelivr.net<span class="regexp">/gh/</span>chiguayeshao<span class="regexp">/pic-bed/im</span>age-<span class="number">20220607182231155</span>.png)</span><br><span class="line"></span><br><span class="line"><span class="comment">### Include/Exclude</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. 开发过程中我们需要使用第三方库或者插件，这些文件都会下载到node_module文件夹中</span><br><span class="line">   - 这些文件是不需要编译就可以使用的</span><br><span class="line">   - 因此我们在编译js的时候要排除node_module</span><br><span class="line"><span class="number">2</span>. 配置webpack</span><br><span class="line">   <span class="number">1</span>. ![image-<span class="number">20220607182501230</span>](https:<span class="regexp">//</span>cdn.jsdelivr.net<span class="regexp">/gh/</span>chiguayeshao<span class="regexp">/pic-bed/im</span>age-<span class="number">20220607182501230</span>.png)</span><br><span class="line">   <span class="number">2</span>. ![image-<span class="number">20220607182527569</span>](https:<span class="regexp">//</span>cdn.jsdelivr.net<span class="regexp">/gh/</span>chiguayeshao<span class="regexp">/pic-bed/im</span>age-<span class="number">20220607182527569</span>.png)</span><br><span class="line"></span><br><span class="line"><span class="comment">### Cache</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. 每次打包都需要经过Eslint检查以及babel编译，速度慢</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. 我们可以缓存eslint检查和babel的编译结果，这样在第二次打包的速度就更快了</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>. 配置webpack （缓存文件不要压缩，可以提高检索效率）</span><br><span class="line"></span><br><span class="line">   <span class="number">1</span>. ```javascript</span><br><span class="line">      options: &#123;</span><br><span class="line">                    cacheDirectory: true, <span class="regexp">//</span> 开启babel编译缓存</span><br><span class="line">                    cacheCompression: false, <span class="regexp">//</span> 缓存文件不要压缩</span><br><span class="line">                  &#125;,</span><br></pre></td></tr></table></figure></code></pre>
</li>
<li><pre><code class="javascript">cache: true, // 开启缓存
      // 缓存目录
      cacheLocation: path.resolve(
        __dirname,
        &quot;../node_modules/.cache/.eslintcache&quot;
      ),
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   <span class="number">3</span>. ![image-<span class="number">20220607182755181</span>](https:<span class="regexp">//</span>cdn.jsdelivr.net<span class="regexp">/gh/</span>chiguayeshao<span class="regexp">/pic-bed/im</span>age-<span class="number">20220607182755181</span>.png)</span><br><span class="line"></span><br><span class="line">   <span class="number">4</span>. ![image-<span class="number">20220607182839166</span>](https:<span class="regexp">//</span>cdn.jsdelivr.net<span class="regexp">/gh/</span>chiguayeshao<span class="regexp">/pic-bed/im</span>age-<span class="number">20220607182839166</span>.png)</span><br><span class="line"></span><br><span class="line"><span class="comment">### Thread</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. 项目越庞大，打包速度越慢</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. 对js文件的处理主要是eslint，babel，terser三个工具，所以我们要提升他们的速度</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>. 开启多进程同时处理js</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>. 配置webpack</span><br><span class="line"></span><br><span class="line">   <span class="number">1</span>. 获取cpu的核数</span><br><span class="line"></span><br><span class="line">      - ```javascript</span><br><span class="line">        <span class="regexp">//</span> nodejs核心模块，直接使用</span><br><span class="line">        const os = require(<span class="string">&quot;os&quot;</span>);</span><br><span class="line">        <span class="regexp">//</span> cpu核数</span><br><span class="line">        const threads = os.cpus().length;</span><br></pre></td></tr></table></figure></code></pre>
</li>
<li><p>下载包 <code>npm i thread-loader -D</code></p>
</li>
<li><pre><code class="javascript">use: [
              &#123;
                loader: &quot;thread-loader&quot;, // 开启多进程
                options: &#123;
                  workers: threads, // 数量
                &#125;,
              &#125;,
              &#123;
                loader: &quot;babel-loader&quot;,
                options: &#123;
                  cacheDirectory: true, // 开启babel编译缓存
                &#125;,
              &#125;,
            ],
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">   4.</span> ![<span class="string">image-20220607193846738</span>](<span class="link">https://cdn.jsdelivr.net/gh/chiguayeshao/pic-bed/image-20220607193846738.png</span>)</span><br><span class="line"><span class="bullet">   5.</span> ![<span class="string">image-20220607193819516</span>](<span class="link">https://cdn.jsdelivr.net/gh/chiguayeshao/pic-bed/image-20220607193819516.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="bullet">   6.</span> ![<span class="string">image-20220607193928589</span>](<span class="link">https://cdn.jsdelivr.net/gh/chiguayeshao/pic-bed/image-20220607193928589.png</span>)</span><br><span class="line"><span class="bullet">   7.</span> 项目较小的时候开多线程打包速度反而变慢，因为开启线程也是耗时操作，因此只有项目到达一定大小的时候开启多线程才能提高打包速度</span><br><span class="line"></span><br><span class="line"><span class="section">## 减少代码体积</span></span><br><span class="line"></span><br><span class="line"><span class="section">### Tree Shaking</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> 开发过程中我们定义了一些工具函数库，或者使用了第三方的工具库或者组件库</span><br><span class="line"><span class="bullet">   -</span> 如果没有特殊处理，当我们只使用了一小部分功能时，打包却要引入整个库，这无疑会增大打包后的体积</span><br><span class="line"><span class="bullet">2.</span> tree shaking 是个术语，用于描述移除js中没有使用上的代码</span><br><span class="line"><span class="bullet">   -</span> 依赖于es module</span><br><span class="line"><span class="bullet">3.</span> webpack默认开启该功能，无需其他配置</span><br><span class="line"></span><br><span class="line"><span class="section">### Babel</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> babel在编译时为每个文件都插入了辅助代码，使代码体积过大</span><br><span class="line"><span class="bullet">2.</span> 可以将这些辅助代码作为一个独立的模块，避免重复引入</span><br><span class="line"><span class="bullet">3.</span> 配置webpack</span><br><span class="line"><span class="bullet">   1.</span> 下载包 <span class="code">`npm i @babel/plugin-transform-runtime -D`</span></span><br><span class="line"><span class="bullet">   2.</span> <span class="code">`@babel/plugin-transform-runtime`</span>可以禁用babel的自动引入</span><br><span class="line"><span class="bullet">   3.</span> ![<span class="string">image-20220607195613506</span>](<span class="link">https://cdn.jsdelivr.net/gh/chiguayeshao/pic-bed/image-20220607195613506.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="section">### Image Minimizer</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> 如果项目中有很多图片，那么打包后图片体积会很大，请求速度会慢</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> 因此需要对图片进行压缩，减少图片体积</span><br><span class="line"></span><br><span class="line"><span class="bullet">3.</span> 配置webpack</span><br><span class="line"></span><br><span class="line"><span class="bullet">   1.</span> 下载包 <span class="code">`npm i image-minimizer-webpack-plugin imagemin -D`</span></span><br><span class="line"><span class="bullet">      1.</span> 无损压缩</span><br><span class="line"><span class="bullet">         -</span> <span class="code">`npm install imagemin-gifsicle imagemin-jpegtran imagemin-optipng imagemin-svgo -D`</span></span><br><span class="line"><span class="bullet">      2.</span> 有损压缩</span><br><span class="line"><span class="bullet">         -</span> <span class="code">`npm install imagemin-gifsicle imagemin-mozjpeg imagemin-pngquant imagemin-svgo -D`</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">   2.</span> <span class="code">```javascript</span></span><br><span class="line"><span class="code">      const ImageMinimizerPlugin = require(&quot;image-minimizer-webpack-plugin&quot;);</span></span><br></pre></td></tr></table></figure></code></pre>
</li>
<li><pre><code class="javascript">// 压缩图片
      new ImageMinimizerPlugin(&#123;
        minimizer: &#123;
          implementation: ImageMinimizerPlugin.imageminGenerate,
          options: &#123;
            plugins: [
              [&quot;gifsicle&quot;, &#123; interlaced: true &#125;],
              [&quot;jpegtran&quot;, &#123; progressive: true &#125;],
              [&quot;optipng&quot;, &#123; optimizationLevel: 5 &#125;],
              [
                &quot;svgo&quot;,
                &#123;
                  plugins: [
                    &quot;preset-default&quot;,
                    &quot;prefixIds&quot;,
                    &#123;
                      name: &quot;sortAttrs&quot;,
                      params: &#123;
                        xmlnsOrder: &quot;alphabetical&quot;,
                      &#125;,
                    &#125;,
                  ],
                &#125;,
              ],
            ],
          &#125;,
        &#125;,
      &#125;),
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   <span class="number">4</span>. ![image-<span class="number">20220607200319039</span>](https:<span class="regexp">//</span>cdn.jsdelivr.net<span class="regexp">/gh/</span>chiguayeshao<span class="regexp">/pic-bed/im</span>age-<span class="number">20220607200319039</span>.png)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 优化代码性能</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Code split</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. 打包代码会把所有代码打包到一个文件中，体积太大</span><br><span class="line"></span><br><span class="line">   <span class="number">1</span>. 如果我们只需要渲染首页，就应该只加载首页的js文件</span><br><span class="line">   <span class="number">2</span>. 所以我们在打包的时候对文件进行代码分割，生成多个js文件，渲染哪个页面就只加载某个js文件</span><br><span class="line">   <span class="number">3</span>. 这样加载的资源少，速度就快</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. code split主要做两件事</span><br><span class="line"></span><br><span class="line">   <span class="number">1</span>. 分割文件：将打包生成的文件进行分割，生成多个js文件</span><br><span class="line">   <span class="number">2</span>. 按需加载：需要哪个文件就加载哪个文件</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>. 多入口</span><br><span class="line"></span><br><span class="line">   - 多个入口文件</span><br><span class="line">   - ![image-<span class="number">20220607202046597</span>](https:<span class="regexp">//</span>cdn.jsdelivr.net<span class="regexp">/gh/</span>chiguayeshao<span class="regexp">/pic-bed/im</span>age-<span class="number">20220607202046597</span>.png)</span><br><span class="line"></span><br><span class="line">   <span class="number">1</span>. 下载包 `npm i webpack webpack-cli html-webpack-plugin -D`</span><br><span class="line"></span><br><span class="line">   <span class="number">2</span>. 配置webpack</span><br><span class="line"></span><br><span class="line">      - ```javascript</span><br><span class="line">        <span class="regexp">//</span> webpack.config.js</span><br><span class="line">        const path = require(<span class="string">&quot;path&quot;</span>);</span><br><span class="line">        const HtmlWebpackPlugin = require(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        module.exports = &#123;</span><br><span class="line">          <span class="regexp">//</span> 单入口</span><br><span class="line">          <span class="regexp">//</span> entry: <span class="string">&#x27;./src/main.js&#x27;</span>,</span><br><span class="line">          <span class="regexp">//</span> 多入口</span><br><span class="line">          entry: &#123;</span><br><span class="line">            main: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">            app: <span class="string">&quot;./src/app.js&quot;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          output: &#123;</span><br><span class="line">            path: path.resolve(__dirname, <span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">            <span class="regexp">//</span> [name]是webpack命名规则，使用chunk的name作为输出的文件名。</span><br><span class="line">            <span class="regexp">//</span> 什么是chunk？打包的资源就是chunk，输出出去叫bundle。</span><br><span class="line">            <span class="regexp">//</span> chunk的name是啥呢？ 比如： entry中xxx: <span class="string">&quot;./src/xxx.js&quot;</span>, name就是xxx。注意是前面的xxx，和文件名无关。</span><br><span class="line">            <span class="regexp">//</span> 为什么需要这样命名呢？如果还是之前写法main.js，那么打包生成两个js文件都会叫做main.js会发生覆盖。(实际上会直接报错的)</span><br><span class="line">            filename: <span class="string">&quot;js/[name].js&quot;</span>,</span><br><span class="line">            clear: true,</span><br><span class="line">          &#125;,</span><br><span class="line">          plugins: [</span><br><span class="line">            new HtmlWebpackPlugin(&#123;</span><br><span class="line">              template: <span class="string">&quot;./public/index.html&quot;</span>,</span><br><span class="line">            &#125;),</span><br><span class="line">          ],</span><br><span class="line">          mode: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure>

- ```javascript
    optimization: &#123;
      // 代码分割配置
      splitChunks: &#123;
        chunks: &quot;all&quot;, // 对所有模块都进行分割
        // 以下是默认值
        // minSize: 20000, // 分割代码最小的大小
        // minRemainingSize: 0, // 类似于minSize，最后确保提取的文件大小不能为0
        // minChunks: 1, // 至少被引用的次数，满足条件才会代码分割
        // maxAsyncRequests: 30, // 按需加载时并行加载的文件的最大数量
        // maxInitialRequests: 30, // 入口js文件最大并行请求数量
        // enforceSizeThreshold: 50000, // 超过50kb一定会单独打包（此时会忽略minRemainingSize、maxAsyncRequests、maxInitialRequests）
        // cacheGroups: &#123; // 组，哪些模块要打包到一个组
        //   defaultVendors: &#123; // 组名
        //     test: /[\\/]node_modules[\\/]/, // 需要打包到一起的模块
        //     priority: -10, // 权重（越大越高）
        //     reuseExistingChunk: true, // 如果当前 chunk 包含已从主 bundle 中拆分出的模块，则它将被重用，而不是生成新的模块
        //   &#125;,
        //   default: &#123; // 其他没有写的配置会使用上面的默认值
        //     minChunks: 2, // 这里的minChunks权重更大
        //     priority: -20,
        //     reuseExistingChunk: true,
        //   &#125;,
        // &#125;,
        // 修改配置
        cacheGroups: &#123;
          // 组，哪些模块要打包到一个组
          // defaultVendors: &#123; // 组名
          //   test: /[\\/]node_modules[\\/]/, // 需要打包到一起的模块
          //   priority: -10, // 权重（越大越高）
          //   reuseExistingChunk: true, // 如果当前 chunk 包含已从主 bundle 中拆分出的模块，则它将被重用，而不是生成新的模块
          // &#125;,
          default: &#123;
            // 其他没有写的配置会使用上面的默认值
            minSize: 0, // 我们定义的文件体积太小了，所以要改打包的最小文件体积
            minChunks: 2,
            priority: -20,
            reuseExistingChunk: true,
          &#125;,
        &#125;,
      &#125;,
  <figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">3.</span> 配置按需加载，动态导入</span><br><span class="line"></span><br><span class="line">   <span class="number">1.</span> ```<span class="javascript">javascript</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&quot;hello main&quot;</span>);</span></span><br><span class="line"><span class="javascript">      </span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.getElementById(<span class="string">&quot;btn&quot;</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 动态导入 --&gt; 实现按需加载</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 即使只被引用了一次，也会代码分割</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">import</span>(<span class="string">&quot;./math.js&quot;</span>).then(<span class="function">(<span class="params">&#123; sum &#125;</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          alert(sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>));</span></span><br><span class="line"><span class="javascript">        &#125;);</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br></pre></td></tr></table></figure>

2. 一旦通过 import 动态导入语法导入模块，模块就被代码分割，同时也能按需加载了</code></pre>
</li>
</ol>
</li>
<li><p>单入口</p>
<ol>
<li><p>单页面应用（spa），只有一个入口（单入口）</p>
</li>
<li><p>配置webpack</p>
<ol>
<li><pre><code class="javascript">const path = require(&quot;path&quot;);
const HtmlWebpackPlugin = require(&quot;html-webpack-plugin&quot;);

module.exports = &#123;
  // 单入口
  entry: &quot;./src/main.js&quot;,
  // 多入口
  // entry: &#123;
  //   main: &quot;./src/main.js&quot;,
  //   app: &quot;./src/app.js&quot;,
  // &#125;,
  output: &#123;
    path: path.resolve(__dirname, &quot;./dist&quot;),
    // [name]是webpack命名规则，使用chunk的name作为输出的文件名。
    // 什么是chunk？打包的资源就是chunk，输出出去叫bundle。
    // chunk的name是啥呢？ 比如： entry中xxx: &quot;./src/xxx.js&quot;, name就是xxx。注意是前面的xxx，和文件名无关。
    // 为什么需要这样命名呢？如果还是之前写法main.js，那么打包生成两个js文件都会叫做main.js会发生覆盖。(实际上会直接报错的)
    filename: &quot;js/[name].js&quot;,
    clean: true,
  &#125;,
  plugins: [
    new HtmlWebpackPlugin(&#123;
      template: &quot;./public/index.html&quot;,
    &#125;),
  ],
  mode: &quot;production&quot;,
  optimization: &#123;
    // 代码分割配置
    splitChunks: &#123;
      chunks: &quot;all&quot;, // 对所有模块都进行分割
      // 以下是默认值
      // minSize: 20000, // 分割代码最小的大小
      // minRemainingSize: 0, // 类似于minSize，最后确保提取的文件大小不能为0
      // minChunks: 1, // 至少被引用的次数，满足条件才会代码分割
      // maxAsyncRequests: 30, // 按需加载时并行加载的文件的最大数量
      // maxInitialRequests: 30, // 入口js文件最大并行请求数量
      // enforceSizeThreshold: 50000, // 超过50kb一定会单独打包（此时会忽略minRemainingSize、maxAsyncRequests、maxInitialRequests）
      // cacheGroups: &#123; // 组，哪些模块要打包到一个组
      //   defaultVendors: &#123; // 组名
      //     test: /[\\/]node_modules[\\/]/, // 需要打包到一起的模块
      //     priority: -10, // 权重（越大越高）
      //     reuseExistingChunk: true, // 如果当前 chunk 包含已从主 bundle 中拆分出的模块，则它将被重用，而不是生成新的模块
      //   &#125;,
      //   default: &#123; // 其他没有写的配置会使用上面的默认值
      //     minChunks: 2, // 这里的minChunks权重更大
      //     priority: -20,
      //     reuseExistingChunk: true,
      //   &#125;,
      // &#125;,
  &#125;,
&#125;;
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">2</span>. ```javascript</span><br><span class="line">       <span class="regexp">//</span> 代码分割配置</span><br><span class="line">       splitChunks: &#123;</span><br><span class="line">         chunks: <span class="string">&quot;all&quot;</span>, <span class="regexp">//</span> 对所有模块都进行分割</span><br><span class="line">         <span class="regexp">//</span> 其他内容用默认配置即可</span><br><span class="line">       &#125;,</span><br></pre></td></tr></table></figure></code></pre>
</li>
<li><p>![image-20220607203135751](/Users/xiaotian/Library/Application Support/typora-user-images/image-20220607203135751.png)</p>
</li>
<li><p>给动态导入的文件取名</p>
<ol>
<li><p>修改main.js</p>
<ul>
<li><pre><code class="javascript">document.getElementById(&quot;btn&quot;).onClick = function () &#123;
  // eslint会对动态导入语法报错，需要修改eslint配置文件
  // webpackChunkName: &quot;math&quot;：这是webpack动态导入模块命名的方式
  // &quot;math&quot;将来就会作为[name]的值显示。
  import(/* webpackChunkName: &quot;math&quot; */ &quot;./js/math.js&quot;).then((&#123; count &#125;) =&gt; &#123;
    console.log(count(2, 1));
  &#125;);
&#125;;
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">2.</span> 下载包 `npm i eslint-plugin-import -D`</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 配置eslint</span><br><span class="line"></span><br><span class="line">   - ```javascript</span><br><span class="line">     <span class="comment">// .eslintrc.js</span></span><br><span class="line">     module.exports = &#123;</span><br><span class="line">       <span class="comment">// 继承 Eslint 规则</span></span><br><span class="line"><span class="symbol">       extends:</span> [<span class="string">&quot;eslint:recommended&quot;</span>],</span><br><span class="line"><span class="symbol">       env:</span> &#123;</span><br><span class="line"><span class="symbol">         node:</span> true, <span class="comment">// 启用node中全局变量</span></span><br><span class="line"><span class="symbol">         browser:</span> true, <span class="comment">// 启用浏览器中全局变量</span></span><br><span class="line">       &#125;,</span><br><span class="line"><span class="symbol">       plugins:</span> [<span class="string">&quot;import&quot;</span>], <span class="comment">// 解决动态导入import语法报错问题 --&gt; 实际使用eslint-plugin-import的规则解决的</span></span><br><span class="line"><span class="symbol">       parserOptions:</span> &#123;</span><br><span class="line"><span class="symbol">         ecmaVersion:</span> <span class="number">6</span>,</span><br><span class="line"><span class="symbol">         sourceType:</span> <span class="string">&quot;module&quot;</span>,</span><br><span class="line">       &#125;,</span><br><span class="line"><span class="symbol">       rules:</span> &#123;</span><br><span class="line">         <span class="string">&quot;no-var&quot;</span>: <span class="number">2</span>, <span class="comment">// 不能使用 var 定义变量</span></span><br><span class="line">       &#125;,</span><br><span class="line">     &#125;;</span><br></pre></td></tr></table></figure></code></pre>
</li>
</ul>
</li>
<li><p>配置webpack，统一命名</p>
<ul>
<li><pre><code class="javascript">filename: &quot;static/js/[name].js&quot;, // 入口文件打包输出资源命名方式
    chunkFilename: &quot;static/js/[name].chunk.js&quot;, // 动态导入输出资源命名方式
    assetModuleFilename: &quot;static/media/[name].[hash][ext]&quot;, // 图片、字体等资源命名方式（注意用hash）
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="bullet">            -</span> ![<span class="string">image-20220608111206852</span>](<span class="link">https://cdn.jsdelivr.net/gh/chiguayeshao/pic-bed/image-20220608111206852.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="bullet">            -</span> ![<span class="string">image-20220608111226416</span>](<span class="link">https://cdn.jsdelivr.net/gh/chiguayeshao/pic-bed/image-20220608111226416.png</span>)</span><br><span class="line"></span><br><span class="line"><span class="section">### preload/prefetch</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> 之前做了代码分割后实现了按需加载（也就是懒加载）</span><br><span class="line"></span><br><span class="line"><span class="bullet">   1.</span> 但是速度不够快，比如一个按钮用户点击了才加载资源，如果该资源非常大的话会有明显的卡顿现象</span><br><span class="line"><span class="bullet">   2.</span> 因此我们想在浏览器空闲的时候加载后续需要使用的资源（预加载）</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> <span class="code">`Preload`</span>：告诉浏览器立即加载资源。</span><br><span class="line"></span><br><span class="line"><span class="bullet">3.</span> <span class="code">`Prefetch`</span>：告诉浏览器在空闲时才开始加载资源。</span><br><span class="line"></span><br><span class="line"><span class="bullet">4.</span> <span class="code">`Preload`</span> 与 <span class="code">`Prefetch`</span> 共同点</span><br><span class="line"></span><br><span class="line"><span class="bullet">   1.</span> 只加载资源，并不执行</span><br><span class="line"><span class="bullet">   2.</span> 都有缓存</span><br><span class="line"></span><br><span class="line"><span class="bullet">5.</span> <span class="code">`Preload`</span> 与 <span class="code">`Prefetch`</span> 区别</span><br><span class="line"></span><br><span class="line"><span class="bullet">   1.</span> <span class="code">`Preload`</span>加载优先级高，<span class="code">`Prefetch`</span>加载优先级低。</span><br><span class="line"><span class="bullet">   2.</span> <span class="code">`preload`</span>只加载当前页面需要使用的资源，<span class="code">`prefetch`</span>可以加载当前页面需要使用的资源，也可以加载下一个页面需要使用的资源</span><br><span class="line"></span><br><span class="line"><span class="bullet">6.</span> 兼容性比较差，<span class="code">`preload`</span>兼容性要高一点</span><br><span class="line"></span><br><span class="line"><span class="bullet">7.</span> 配置</span><br><span class="line"></span><br><span class="line"><span class="bullet">   1.</span> 下载包 <span class="code">`npm i @vue/preload-webpack-plugin -D`</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">   2.</span> <span class="code">```javascript</span></span><br><span class="line"><span class="code">      // css压缩</span></span><br><span class="line"><span class="code">          // new CssMinimizerPlugin(),</span></span><br><span class="line"><span class="code">          new PreloadWebpackPlugin(&#123;</span></span><br><span class="line"><span class="code">            rel: &quot;preload&quot;, // preload兼容性更好</span></span><br><span class="line"><span class="code">            as: &quot;script&quot;,</span></span><br><span class="line"><span class="code">            // rel: &#x27;prefetch&#x27; // prefetch兼容性更差</span></span><br><span class="line"><span class="code">          &#125;),</span></span><br></pre></td></tr></table></figure></code></pre>
</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
<li><p><img src="https://cdn.jsdelivr.net/gh/chiguayeshao/pic-bed/image-20220608114848178.png" alt="image-20220608114848178"></p>
</li>
</ol>
</li>
</ol>
<h3 id="network-cache"><a href="#network-cache" class="headerlink" title="network cache"></a>network cache</h3><ol>
<li><p>对静态资源使用缓存来优化，浏览器再二次请求直接读取缓存，速度更快</p>
</li>
<li><p>回出现一个问题：前后输出的文件名都是一样的，发布新版本浏览器会读取缓存，不会加载新资源</p>
<ol>
<li>我们要从文件名入手，确保更新后的文件名与之前不一样</li>
</ol>
</li>
<li><p>使用hash</p>
<ul>
<li><p>fullhash（webpack4 是 hash）每次修改任何一个文件，所有文件名的 hash 至都将改变。所以一旦修改了任何一个文件，整个项目的文件缓存都将失效。</p>
</li>
<li><p>chunkhash 根据不同的入口文件(Entry)进行依赖文件解析、构建对应的 chunk，生成对应的哈希值。我们 js 和 css 是同一个引入，会共享一个 hash 值。</p>
</li>
<li><p>contenthash 根据文件内容生成 hash 值，只有文件内容变化了，hash 值才会变化。所有文件 hash 值是独享且不同的。</p>
</li>
<li><p><img src="https://cdn.jsdelivr.net/gh/chiguayeshao/pic-bed/image-20220608120638753.png" alt="image-20220608120638753"></p>
</li>
<li><p><img src="https://cdn.jsdelivr.net/gh/chiguayeshao/pic-bed/image-20220608120658005.png" alt="image-20220608120658005"></p>
</li>
</ul>
</li>
<li><p>出现问题：只修改了一个文件，但是main.js的hash也发生了变化，缓存失效</p>
<ol>
<li><p>原因：引用的文件发生变化，导致main.js的content也发生了变化，最终main.js生成新的hash，是我们不希望看到的</p>
</li>
<li><p>解决</p>
<ol>
<li><p>将hash值单独保存在runtime文件中</p>
</li>
<li><p>runtime 文件只保存文件的 hash 值和它们与文件关系，整个文件体积就比较小，所以变化重新请求的代价也小。</p>
</li>
<li><pre><code class="javascript">    // 提取runtime文件
    runtimeChunk: &#123;
      name: (entrypoint) =&gt; `runtime~$&#123;entrypoint.name&#125;`, // runtime文件命名规则
    &#125;,
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="section">### core-js</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> babel已经对js代码进行了一定的兼容性处理，我们使用 @babel/preset-env 智能预设来处理兼容性</span><br><span class="line"></span><br><span class="line"><span class="bullet">   1.</span> 但是es6有些语法并没有编译转换，比如箭头函数，promise， async等</span><br><span class="line"><span class="bullet">   2.</span> 所以还是存在一定的兼容性问题，遇到低版本浏览器可能出现报错</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> <span class="code">`core-js`</span> 是专门用来做 ES6 以及以上 API 的 <span class="code">`polyfill`</span>。</span><br><span class="line"></span><br><span class="line"><span class="bullet">3.</span> 配置webpack</span><br><span class="line"></span><br><span class="line"><span class="bullet">   1.</span> 下载包 <span class="code">`npm i @babel/eslint-parser -D`</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">   2.</span> 下载包 <span class="code">`npm i core-js`</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">   3.</span> 可以手动全部引入和手动按需引入（体积大/麻烦）</span><br><span class="line"></span><br><span class="line"><span class="bullet">      1.</span> <span class="code">```javascript</span></span><br><span class="line"><span class="code">         import &quot;core-js&quot;;</span></span><br></pre></td></tr></table></figure></code></pre>
</li>
<li><pre><code class="javascript">import &quot;core-js/es/promise&quot;;
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">4.</span> 配置自动按需引入</span><br><span class="line"></span><br><span class="line">   <span class="number">1.</span> 配置babel.config.js</span><br><span class="line"></span><br><span class="line">   <span class="number">2.</span> ```javascript</span><br><span class="line">      module.exports = &#123;</span><br><span class="line">        <span class="comment">// 智能预设：能够编译ES6语法</span></span><br><span class="line">        <span class="symbol">presets:</span> [</span><br><span class="line">          [</span><br><span class="line">            <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">            <span class="comment">// 按需加载core-js的polyfill</span></span><br><span class="line">            &#123; <span class="attr">useBuiltIns:</span> <span class="string">&quot;usage&quot;</span>, <span class="attr">corejs:</span> &#123; <span class="attr">version:</span> <span class="string">&quot;3&quot;</span>, <span class="attr">proposals:</span> <span class="literal">true</span> &#125; &#125;,</span><br><span class="line">          ],</span><br><span class="line">        ],</span><br><span class="line">      &#125;;</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="pwa"><a href="#pwa" class="headerlink" title="pwa"></a>pwa</h3><ol>
<li><p>希望提供离线服务</p>
</li>
<li><p>配置webpack</p>
<ol>
<li><p>下载包 <code>npm i workbox-webpack-plugin -D</code></p>
</li>
<li><p>修改webpack.config.js</p>
<ol>
<li><pre><code class="javascript">const WorkboxPlugin = require(&quot;workbox-webpack-plugin&quot;);
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="number">2</span><span class="string">.</span> <span class="string">```javascript</span></span><br><span class="line">   <span class="string">new</span> <span class="string">WorkboxPlugin.GenerateSW(&#123;</span></span><br><span class="line">         <span class="string">//</span> <span class="string">这些选项帮助快速启用</span> <span class="string">ServiceWorkers</span></span><br><span class="line">         <span class="string">//</span> <span class="string">不允许遗留任何“旧的”</span> <span class="string">ServiceWorkers</span></span><br><span class="line">         <span class="attr">clientsClaim:</span> <span class="literal">true</span><span class="string">,</span></span><br><span class="line">         <span class="attr">skipWaiting:</span> <span class="literal">true</span><span class="string">,</span></span><br><span class="line">       <span class="string">&#125;),</span></span><br></pre></td></tr></table></figure></code></pre>
</li>
<li><p><img src="https://cdn.jsdelivr.net/gh/chiguayeshao/pic-bed/image-20220608122751327.png" alt="image-20220608122751327"></p>
</li>
</ol>
</li>
<li><p>修改main.js</p>
<ul>
<li><pre><code class="javascript">if (&quot;serviceWorker&quot; in navigator) &#123;
  window.addEventListener(&quot;load&quot;, () =&gt; &#123;
    navigator.serviceWorker
      .register(&quot;/service-worker.js&quot;)
      .then((registration) =&gt; &#123;
        console.log(&quot;SW registered: &quot;, registration);
      &#125;)
      .catch((registrationError) =&gt; &#123;
        console.log(&quot;SW registration failed: &quot;, registrationError);
      &#125;);
  &#125;);
&#125;</code></pre>
</li>
</ul>
</li>
</ol>
</li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Webpack/" rel="tag"># Webpack</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/06/15/Webpack%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/" rel="prev" title="Webpack基础配置">
                  <i class="fa fa-chevron-left"></i> Webpack基础配置
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/07/16/JavaScript%20%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0/" rel="next" title="JavaScript 箭头函数">
                  JavaScript 箭头函数 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-address-card"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Developed by Xiaotian Ye</span>
</div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  

<script src="/js/local-search.js"></script>






  






<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":345},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
